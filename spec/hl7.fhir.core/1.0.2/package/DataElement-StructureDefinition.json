{"resourceType":"DataElement","id":"StructureDefinition","meta":{"lastUpdated":"2015-10-24T07:41:03.495+11:00"},"url":"http://hl7.org/fhir/DataElement/StructureDefinition","status":"draft","experimental":true,"stringency":"fully-specified","element":[{"path":"StructureDefinition","short":"Structural Definition","definition":"A definition of a FHIR structure. This resource is used to describe the underlying resources, data types defined in FHIR, and also for describing extensions, and constraints on resources and data types.","alias":["Template","Profile"],"min":1,"max":"1","type":[{"code":"DomainResource"}],"constraint":[{"key":"sdf-11","requirements":"Ensure that the constrainedType is not inconsistent with the other information in the structure","severity":"error","human":"If there's a constrained type, its content must match the path name in the first element of a snapshot","xpath":"not(exists(f:constrainedType)) or not(exists(f:snapshot)) or (f:constrainedType/@value = f:snapshot/f:element[1]/f:path/@value)"},{"key":"sdf-5","severity":"error","human":"If the structure defines an extension then the structure must have context information","xpath":"not(f:constrainedType/@value = 'extension') or (exists(f:context) and exists(f:contextType))"},{"key":"sdf-12","requirements":"Ensure that element.base appears with base or not","severity":"error","human":"element.base cannot appear if there is no base on the structure definition","xpath":"f:base or not(exists(f:snapshot/f:element/f:base) or exists(f:differential/f:element/f:base))"},{"key":"sdf-4","severity":"error","human":"A structure must have a base unless abstract = true","xpath":"(f:abstract/@value =true()) or exists(f:base)"},{"key":"sdf-13","requirements":"Ensure that element.base appears if there's a constrained type on the structure definition","severity":"error","human":"element.base must appear if there is a base on the structure definition","xpath":"not(f:constrainedType) or not(f:snapshot/f:element[not(f:base)])"},{"key":"sdf-7","severity":"error","human":"If the structure describes a base Resource or Type, the URL has to start with \"http://hl7.org/fhir/StructureDefinition/\" and the tail must match the id","xpath":"exists(f:constrainedType) or f:url/@value=concat('http://hl7.org/fhir/StructureDefinition/', f:id/@value)"},{"key":"sdf-6","severity":"error","human":"A structure must have either a differential, or a snapshot (or both)","xpath":"exists(f:snapshot) or exists(f:differential)"},{"key":"sdf-1","severity":"error","human":"Element paths must be unique unless the structure is a constraint","xpath":"exists(f:constrainedType) or (count(f:snapshot/f:element) = count(distinct-values(f:snapshot/f:element/f:path/@value)))"},{"key":"sdf-8","severity":"error","human":"In any snapshot or differential, all the elements except the first have to have a path that starts with the path of the first + \".\"","xpath":"string-join(for $elementName in f:*[self::f:snapshot or self::f:differential]/f:element[position()>1]/f:path/@value return if (starts-with($elementName, concat($elementName/ancestor::f:element/parent::f:*/f:element[1]/f:path/@value, '.'))) then '' else $elementName,'')=''"},{"key":"sdf-9","requirements":"Because these 3 fields seem to be have overlapping meaning with the ones in the root of StructureDefinition","severity":"error","human":"In any snapshot or differential, no label, code or requirements on the an element without a \".\" in the path (e.g. the first element)","xpath":"not(exists(f:snapshot/f:element[not(contains(f:path/@value, '.')) and (f:label or f:code or f:requirements)])) and not(exists(f:differential/f:element[not(contains(f:path/@value, '.')) and (f:label or f:code or f:requirements)]))"},{"key":"sdf-10","requirements":"Ensure that there's a base unless the type is abstract and there's no constrainedType","severity":"error","human":"If the structure is not abstract, or there's a constrained type, then there SHALL be a base","xpath":"(f:abstract/@value=true()) or not(exists(f:constrainedType)) or exists(f:base)"}],"mapping":[{"identity":"rim","map":"n/a"},{"identity":"w5","map":"conformance.content"}]}]}